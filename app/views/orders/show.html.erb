<h1 class="pull-left">Order: <%= @order.name %></h1>
<%= render 'nav' %>
<br clear="all" />
<h2>Deadline: <%= @order.try(:deadline).try(:strftime, '%F') %></h2>
<h2>Proofs:</h2>

<% if @order.softwear_crm_id.blank? %>
  Assign a SoftWEAR-CRM ID to this order to see proofs
<% else %>
  <% begin %>
    <%= render 'proofs', order: @order.crm %>
  <% rescue StandardError => e %>
    <%= javascript_tag do %>
      console.log('<%=j "#{e.class.name}: #{e.message}" %>');
    <% end %>
  <% end %>
<% end %>

<div class="col-xs-12">
  <div id='order-pre-production' class='row clear-after'>
    <div class='panel panel-default pre_production_trains'>
      <div class="panel-heading">Order Pre Production</div>
      <div class="panel-body">
        <% Train.each_train_of_type(:pre_production, @order) do |train| %>
          <%= train_entry(train) %>
        <% end %>

        <% unless Train.available_trains_of_type(:pre_production, @order).empty? %>
          <%= link_to_add_train(@order, :pre_production, "#order-pre-production") %>
        <% end %>
        <div class='clearfix'></div>
        </div>
    </div>
  </div>
</div>

<div class='row'>
  <% if @order.has_imprint_groups? %>
    <div class="col-xs-8 col-lg-8" id='jobs-panel'>
      <%= render 'jobs', order: @order %>
    </div>
    <div class="col-xs-4 col-lg-4" id='imprint-groups-panel'>
      <%= render 'imprint_groups', order: @order %>
    </div>
  <% else %>
    <div class="col-xs-12">
      <%= render 'jobs', order: @order %>
    </div>
  <% end %>
</div>

<div class='clearfix'></div>

<div id='order-post-production' class='row'>
  <div class='well clearfix clear-after post_production_trains'>
    <h4>Order Post Production</h4>
    <% Train.each_train_of_type(:post_production, @order) do |train| %>
      <%= train_entry(train) %>
    <% end %>

    <% unless Train.available_trains_of_type(:post_production, @order).empty? %>
      <%= link_to_add_train(@order, :post_production, "#order-post-production") %>
    <% end %>
  </div>
</div>
